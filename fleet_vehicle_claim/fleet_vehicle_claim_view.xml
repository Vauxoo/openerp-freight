<openerp>
    <data>
        
        <record model="ir.ui.view" id="view_crm_claim_vehicle_form_inherit">
            <field name="name">crm.claim.vehicle.form.inherit</field>
            <field name="model">crm.claim</field>
            <field name="inherit_id" ref="crm_claim.crm_case_claims_form_view"/>
            <field name="arch" type="xml">
                <field name="date" position="after">
                    <field name="vehicle_claim_id" on_change="set_is_vehicle(vehicle_id)"/>
                    <field name="is_vehicle" invisible="True"/>
                </field>
                <field name="section_id" position="replace">
                    <field name="section_id" attrs="{'invisible':[('is_vehicle','=',True),]}"/>
                </field>
                <field name="user_fault" position="replace">
                    <field name="user_fault" attrs="{'invisible':[('is_vehicle','=',True),]}"/>
                    <field name="driver_id" attrs="{'invisible':[('is_vehicle','=',False),]}"/>
                </field>
            </field>
        </record>
        <record model="ir.ui.view" id="view_crm_claim_vehicle_tree">
            <field name="name">crm.claim.vehicle.tree</field>
            <field name="model">crm.claim</field>
            <field name="arch" type="xml">

                <tree string="Vehicle Claims" colors="blue:state=='pending' and not(date_deadline and (date_deadline &lt; current_date));gray:state in ('close', 'cancel');red:date_deadline and (date_deadline &lt; current_date)">
                    <field name="name"/>
                    <field name="vehicle_claim_id"/>
                    <field name="partner_id"/>
                    <field name="user_id"/>
                    <field name="date"/>
                    <field name="stage_id"/>
                    <field name="date_action_next"/>
                    <field name="action_next"/>
                    <field name="categ_id" string="Type"/>
                    <field name="date_deadline" invisible="1"/>
                    <field name="date_closed" invisible="1"/>
                    <field name="state" groups="base.group_no_one"/>
                </tree>

            </field>
        </record>

            <record model="ir.ui.view" id="view_fleet_vehicle_claims_form_inherit">
            <field name="name">fleet.vehicle.claims.form.inherit</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet_special_equipment.view_fleet_vehicle_form_inherit"/>
            <field name="arch" type="xml">
                <xpath expr="/form/sheet/notebook/page[@string='Equipment']" position="after">
                        <page string="Vehicle Claims">
                            <field name="claim_ids"/>
                        </page>
                </xpath>
            </field>
        </record> 

        <record model="ir.actions.act_window" id="crm_case_categ_claim0">
            <field name="name">Claims</field>
            <field name="res_model">crm.claim</field>
            <field name="view_mode">tree,calendar,form</field>
            <field name="view_id" ref="view_crm_claim_vehicle_tree"/>
            <field name="context">{"search_default_user_id":uid, "is_vehicle":True}</field>
            <field name="search_view_id" ref="crm_claim.view_crm_case_claims_filter"/>
            <field name="domain">[('is_vehicle','=',True)]</field>
            <field name="help">Record and track your vehicles' claims. Claims may be linked to a behavior of a driver, cordiality and some other faults related to the driver or the vehicle. You can send emails with attachments and keep the full history for a claim (emails sent, intervention type and so on). Claims may automatically be linked to an email address using the mail gateway module.</field>
        </record>

        <menuitem name="Vehicle Claims" id="menu_crm_case_claims"
            parent="fleet.fleet_vehicles" action="crm_case_categ_claim0" sequence="10"/>
    </data>
</openerp>
