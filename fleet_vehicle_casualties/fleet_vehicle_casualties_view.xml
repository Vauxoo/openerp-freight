<openerp>
    <data>
        
 <record model="ir.ui.view" id="fleet_vehicle_casualties_form_view">
            <field name="name">Vehicle - Casualties Form</field>
            <field name="model">fleet.vehicle.casualty</field>
            <field name="arch" type="xml">
                <form string="Casualty" version="7.0">
                <header>
                    <button name="case_close" string="Settle" type="object" class="oe_highlight"
                            states="draft,open,pending" groups="base.group_user"/>
                    <button name="case_cancel" string="Reject" type="object" groups="base.group_user"
                            states="draft,open,pending"/>
                    <field name="stage_id" widget="statusbar" clickable="True"/>
                </header>
                <sheet string="Casualties">
                    <group>
                        <field name="name" string="Casualty Name"/>
                        <field name="date" string="Casualty Date"/>
                    <field name="vehicle_id"/>
                    <field name="type_id"/>
                    </group>
                    <group colspan="4" col="4"  groups="base.group_user">
                        <field name="user_id"/>
                        <field name="priority"/>
                        <field name="section_id" invisible="True"/>
                        <field name="date_deadline"/>
                        <field name="state" groups="base.group_no_one"/>
                    </group>
                    <group colspan="4" col="4">
                        <notebook>
                            <page string="Claim Description">
                                <group colspan="2" col="2" groups="base.group_user">
                                    <separator colspan="2" string="Claim Reporter"/>
                                    <field name="partner_id" string="Partner"
                                        on_change="onchange_partner_id(partner_id)"/>
                                    <field name="partner_phone"/>
                                    <field name="email_from" widget="email"/>
                                </group>
                                <group colspan="2" col="2" groups="base.group_user">
                                    <separator colspan="2" string="Responsibilities"/>
                                    <field name="driver_id"/>
                                    <field name="categ_id" widget="selection"
                                        domain="[('object_id.model', '=', 'crm.claim')]"/>
                                    <field name="ref"/>
                                </group>
                                <separator colspan="4" string="Claim/Action Description" groups="base.group_user"/>
                                <field name="description" colspan="4" nolabel="1"/>
                            </page>
                            <page string="Follow Up" groups="base.group_user">
                                <group colspan="2" col="2">
                                    <separator colspan="2" string="Actions"/>
                                    <field name="date_action_next"/>
                                    <field name="action_next"/>
                                </group>
                                <group colspan="2" col="2" groups="base.group_no_one">
                                    <separator colspan="2" string="Dates"/>
                                    <field name="create_date"/>
                                    <field name="date_closed"/>
                                    <field name="write_date"/>
                                </group>

                                <group colspan="2" col="2">
                                    <separator colspan="2" string="Root Causes"/>
                                    <field name="cause" colspan="2" nolabel="1"/>
                                </group>
                                <group colspan="2" col="2">
                                    <separator colspan="2" string="Resolution Actions"/>
                                    <field name="type_action"/>
                                    <field name="resolution" colspan="2" nolabel="1"/>
                                </group>
                            </page>
                        </notebook>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers" groups="base.group_user"/>
                    <field name="message_ids" widget="mail_thread" placeholder="Share a note..."/>
                </div>
                </form>
            </field>
        </record>


        <record model="ir.ui.view" id="view_vehicle_casualties_tree">
            <field name="name">fleet.vehicle.casualty.tree</field>
            <field name="model">fleet.vehicle.casualty</field>
            <field name="arch" type="xml">
                <tree string="Vehicle Casualties" colors="blue:state=='pending' and not(date_deadline and (date_deadline &lt; current_date));gray:state in ('close', 'cancel');red:date_deadline and (date_deadline &lt; current_date)">
                    <field name="name"/>
                    <field name="vehicle_id"/>
                    <field name="type_id"/>
                    <field name="partner_id"/>
                    <field name="user_id"/>
                    <field name="date"/>
                    <field name="stage_id"/>
                    <field name="date_action_next"/>
                    <field name="action_next"/>
                    <field name="categ_id" string="Type"/>
                    <field name="date_deadline" invisible="1"/>
                    <field name="date_closed" invisible="1"/>
                    <field name="state" groups="base.group_no_one"/>
                </tree>

            </field>
        </record>
            <record model="ir.ui.view" id="view_fleet_vehicle_casualties_form_inherit">
            <field name="name">fleet.vehicle.casualties.form.inherit</field>
            <field name="model">fleet.vehicle</field>
            <field name="inherit_id" ref="fleet_special_equipment.view_fleet_vehicle_form_inherit"/>
            <field name="arch" type="xml">
                <xpath expr="/form/sheet/notebook/page[@string='Equipment']" position="after">
                        <page string="Casualties">
                            <field name="casualties_ids"/>
                        </page>
                </xpath>
            </field>
        </record>   

<!--Casualties action inherited from crm.claim-->
        <record model="ir.actions.act_window" id="crm_case_categ_casualty">
            <field name="name">Casualties</field>
            <field name="res_model">fleet.vehicle.casualty</field>
            <field name="view_mode">tree,calendar,form</field>
            <field name="view_id" ref="fleet_vehicle_casualties.view_vehicle_casualties_tree"/>
            <field name="context">{"search_default_user_id":uid, "is_vehicle":True}</field>
            <field name="search_view_id" ref="crm_claim.view_crm_case_claims_filter"/>
            <field name="domain">[('type_id','!=',False)]</field>
            <field name="help">Record and track your vehicles casualties. Casualties may be linked to an accident, being this accidents or incidents, manageing states of the paperwork and fiscal issues related to it. You can send emails with attachments and keep the full history for a casualty (emails sent, intervention type and so on). Casualties may automatically be linked to an email address using the mail gateway module.</field>
        </record>


        <menuitem name="Vehicle Casualties" id="menu_crm_case_claims"
            parent="fleet.fleet_vehicles" action="crm_case_categ_casualty" sequence="10"/>
    </data>
</openerp>
